# Room Master - Hotel Booking Mobile App

## AI Agent Development Instructions for GitHub Copilot

### Project Overview

Build a mobile application for "Room Master" hotel business using Expo (React Native). This is a **frontend-only** mobile app that connects to existing backend APIs. The app allows customers to browse and book hotel rooms.

---

## Tech Stack Requirements

### Core Technologies

- **Framework**: Expo (React Native)
- **Language**: TypeScript
- **State Management**: React Context API or Zustand
- **Navigation**: React Navigation v6+
- **API Calls**: Axios or fetch
- **Form Handling**: React Hook Form
- **Styling**: React Native StyleSheet or NativeWind (Tailwind for RN)

### Recommended Libraries

```json
{
  "expo": "~51.0.0",
  "react": "18.2.0",
  "react-native": "0.74.0",
  "@react-navigation/native": "^6.1.0",
  "@react-navigation/stack": "^6.3.0",
  "@react-navigation/bottom-tabs": "^6.5.0",
  "axios": "^1.6.0",
  "react-hook-form": "^7.50.0",
  "expo-secure-store": "~13.0.0",
  "date-fns": "^3.0.0",
  "react-native-calendars": "^1.1300.0"
}
```

---

## Project Structure

```
room-master-app/
├── src/
│   ├── api/
│   │   ├── client.ts              # Axios instance with interceptors
│   │   ├── endpoints.ts           # API endpoint definitions
│   │   └── services/
│   │       ├── auth.service.ts    # Authentication APIs
│   │       ├── room.service.ts    # Room-related APIs
│   │       └── booking.service.ts # Booking APIs
│   ├── components/
│   │   ├── common/
│   │   │   ├── Button.tsx
│   │   │   ├── Input.tsx
│   │   │   ├── Card.tsx
│   │   │   └── LoadingSpinner.tsx
│   │   ├── rooms/
│   │   │   ├── RoomCard.tsx
│   │   │   └── RoomList.tsx
│   │   └── bookings/
│   │       └── BookingCard.tsx
│   ├── screens/
│   │   ├── auth/
│   │   │   ├── LoginScreen.tsx
│   │   │   ├── SignupScreen.tsx
│   │   │   └── ForgotPasswordScreen.tsx
│   │   ├── home/
│   │   │   └── HomeScreen.tsx
│   │   ├── rooms/
│   │   │   ├── RoomListScreen.tsx
│   │   │   └── RoomDetailScreen.tsx
│   │   ├── booking/
│   │   │   ├── BookingScreen.tsx
│   │   │   └── BookingConfirmationScreen.tsx
│   │   └── profile/
│   │       ├── ProfileScreen.tsx
│   │       └── MyBookingsScreen.tsx
│   ├── navigation/
│   │   ├── AppNavigator.tsx       # Main navigation
│   │   ├── AuthNavigator.tsx      # Auth flow
│   │   └── MainNavigator.tsx      # Authenticated flow
│   ├── context/
│   │   ├── AuthContext.tsx        # Authentication state
│   │   └── BookingContext.tsx     # Booking state
│   ├── hooks/
│   │   ├── useAuth.ts
│   │   ├── useRooms.ts
│   │   └── useBookings.ts
│   ├── types/
│   │   ├── auth.types.ts
│   │   ├── room.types.ts
│   │   └── booking.types.ts
│   ├── utils/
│   │   ├── storage.ts             # Secure storage helpers
│   │   ├── validation.ts          # Form validation
│   │   └── dateHelpers.ts         # Date formatting
│   └── constants/
│       ├── colors.ts
│       └── config.ts              # API base URL, etc.
├── assets/
│   ├── images/
│   └── fonts/
├── App.tsx
└── app.json
```

---

## Core Features to Implement

### 1. Authentication Module

- **Login Screen**: Email/password authentication
- **Sign Up Screen**: New user registration (name, email, password, phone)
- **Forgot Password**: Email-based password reset flow
- **Reset Password**: Password reset with token from email
- **Token Management**: Store access token and refresh token in Expo SecureStore
- **Auto-login**: Check stored tokens on app launch
- **Token Refresh**: Automatically refresh expired access tokens using refresh token

### 2. Room Browsing

- **Room List Screen**: Display available rooms with search and filter capabilities
  - Filter by date range (check-in/check-out)
  - Filter by price range (min/max)
  - Filter by room type
  - Filter by tags/amenities
- **Room Detail Screen**: Show comprehensive room details
  - Room number and floor
  - Room type information
  - Price per night
  - Room tags/features
  - Image gallery (if available)
  - Description
  - Availability status
- **Search Functionality**: Real-time search with multiple filter parameters

### 3. Booking Flow

- **Date Selection**: Check-in and check-out date picker
- **Guest Count**: Select number of guests
- **Promotion Code**: Option to apply promotion code
- **Price Calculation**: Display total price with breakdown
  - Base price × number of nights
  - Applied promotions/discounts
  - Final total
- **Booking Confirmation**: Review all details before submitting
- **Booking Success**: Confirmation screen with booking details

### 4. User Profile & Bookings

- **Profile Management**: View/edit user details (name, phone, email)
- **Change Password**: Update password with old password verification
- **Booking History**: List of all bookings
  - Filter by status (pending, confirmed, checked_in, checked_out, cancelled)
  - Show upcoming vs past bookings
- **Booking Details**: View specific booking information
  - Room details
  - Dates and guest count
  - Total price
  - Booking status
  - Check-in/Check-out information
- **Cancel Booking**: Cancel future bookings

### 5. Promotions

- **Available Promotions**: Browse all active promotions (public access)
- **My Promotions**: View claimed promotions (requires authentication)
- **Claim Promotion**: Enter promotion code to claim
- **Apply to Booking**: Use promotion when creating booking

---

## API Integration Guidelines

### API Client Setup

```typescript
// src/api/client.ts
import axios from "axios";
import * as SecureStore from "expo-secure-store";
import { API_BASE_URL } from "../constants/config";

const apiClient = axios.create({
  baseURL: API_BASE_URL, // https://room-master-dcdsfng4c7h7hwbg.eastasia-01.azurewebsites.net/v1
  headers: {
    "Content-Type": "application/json",
  },
});

// Request interceptor to add auth token
apiClient.interceptors.request.use(
  async (config) => {
    const token = await SecureStore.getItemAsync("authToken");
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// Response interceptor for error handling
apiClient.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      // Handle token expiration
      await SecureStore.deleteItemAsync("authToken");
      await SecureStore.deleteItemAsync("refreshToken");
      // Navigate to login
    }
    return Promise.reject(error);
  }
);

export default apiClient;
```

### Actual API Endpoints (From Backend Documentation)

**Authentication** (`/customer/auth/*`)

- `POST /customer/auth/register` - Customer registration
- `POST /customer/auth/login` - Customer login
- `POST /customer/auth/logout` - Customer logout
- `POST /customer/auth/refresh-tokens` - Refresh auth tokens
- `POST /customer/auth/forgot-password` - Request password reset
- `POST /customer/auth/reset-password` - Reset password with token

**Rooms** (`/customer/rooms/*`)

- `GET /customer/rooms` - Search available rooms (with query params)
- `GET /customer/rooms/{roomId}` - Get room details

**Bookings** (`/customer/bookings/*`)

- `POST /customer/bookings` - Create a new booking
- `GET /customer/bookings` - Get all user's bookings
- `GET /customer/bookings/{id}` - Get booking details
- `POST /customer/bookings/{id}/cancel` - Cancel booking

**Profile** (`/customer/profile/*`)

- `GET /customer/profile` - Get customer profile
- `PATCH /customer/profile` - Update customer profile
- `POST /customer/profile/change-password` - Change password

**Promotions** (`/customer/promotions/*`)

- `GET /customer/promotions/available` - Get all available promotions (public)
- `GET /customer/promotions/my-promotions` - Get customer's claimed promotions (requires auth)
- `POST /customer/promotions/claim` - Claim a promotion by code (requires auth)

---

## Type Definitions

### API Service Examples

```typescript
// src/api/services/auth.service.ts
import apiClient from "../client";

export const authService = {
  register: async (data: {
    email: string;
    password: string;
    name: string;
    phone?: string;
  }) => {
    const response = await apiClient.post("/customer/auth/register", data);
    return response.data;
  },

  login: async (email: string, password: string) => {
    const response = await apiClient.post("/customer/auth/login", {
      email,
      password,
    });
    return response.data; // Returns { user, tokens: { access: { token, expires }, refresh: { token, expires } } }
  },

  logout: async (refreshToken: string) => {
    const response = await apiClient.post("/customer/auth/logout", {
      refreshToken,
    });
    return response.data;
  },

  refreshTokens: async (refreshToken: string) => {
    const response = await apiClient.post("/customer/auth/refresh-tokens", {
      refreshToken,
    });
    return response.data;
  },

  forgotPassword: async (email: string) => {
    const response = await apiClient.post("/customer/auth/forgot-password", {
      email,
    });
    return response.data;
  },

  resetPassword: async (token: string, password: string) => {
    const response = await apiClient.post("/customer/auth/reset-password", {
      token,
      password,
    });
    return response.data;
  },
};

// src/api/services/room.service.ts
export const roomService = {
  searchRooms: async (params?: {
    checkInDate?: string;
    checkOutDate?: string;
    minPrice?: number;
    maxPrice?: number;
    roomTypeId?: string;
    tags?: string[];
  }) => {
    const response = await apiClient.get("/customer/rooms", { params });
    return response.data; // Returns array of rooms
  },

  getRoomDetails: async (roomId: string) => {
    const response = await apiClient.get(`/customer/rooms/${roomId}`);
    return response.data;
  },
};

// src/api/services/booking.service.ts
export const bookingService = {
  createBooking: async (data: {
    roomId: string;
    checkInDate: string;
    checkOutDate: string;
    numberOfGuests: number;
    promotionId?: string;
  }) => {
    const response = await apiClient.post("/customer/bookings", data);
    return response.data;
  },

  getBookings: async (params?: {
    status?: string;
    sortBy?: string;
    limit?: number;
    page?: number;
  }) => {
    const response = await apiClient.get("/customer/bookings", { params });
    return response.data;
  },

  getBookingDetails: async (bookingId: string) => {
    const response = await apiClient.get(`/customer/bookings/${bookingId}`);
    return response.data;
  },

  cancelBooking: async (bookingId: string) => {
    const response = await apiClient.post(
      `/customer/bookings/${bookingId}/cancel`
    );
    return response.data;
  },
};

// src/api/services/profile.service.ts
export const profileService = {
  getProfile: async () => {
    const response = await apiClient.get("/customer/profile");
    return response.data;
  },

  updateProfile: async (data: {
    name?: string;
    phone?: string;
    // other profile fields
  }) => {
    const response = await apiClient.patch("/customer/profile", data);
    return response.data;
  },

  changePassword: async (oldPassword: string, newPassword: string) => {
    const response = await apiClient.post("/customer/profile/change-password", {
      oldPassword,
      newPassword,
    });
    return response.data;
  },
};

// src/api/services/promotion.service.ts
export const promotionService = {
  getAvailablePromotions: async () => {
    const response = await apiClient.get("/customer/promotions/available");
    return response.data;
  },

  getMyPromotions: async () => {
    const response = await apiClient.get("/customer/promotions/my-promotions");
    return response.data;
  },

  claimPromotion: async (code: string) => {
    const response = await apiClient.post("/customer/promotions/claim", {
      code,
    });
    return response.data;
  },
};
```

### Type Definitions (Based on Real API)

```typescript
// src/types/auth.types.ts
export interface User {
  id: string;
  email: string;
  name: string;
  phone?: string;
  role: "customer";
  isEmailVerified: boolean;
}

export interface AuthTokens {
  access: {
    token: string;
    expires: string;
  };
  refresh: {
    token: string;
    expires: string;
  };
}

export interface AuthResponse {
  user: User;
  tokens: AuthTokens;
}

export interface RegisterData {
  email: string;
  password: string;
  name: string;
  phone?: string;
}

// src/types/room.types.ts
export interface RoomType {
  id: string;
  name: string;
  description: string;
  basePrice: number;
}

export interface RoomTag {
  id: string;
  name: string;
  description?: string;
}

export interface Room {
  id: string;
  roomNumber: string;
  floor: number;
  roomType: RoomType;
  tags: RoomTag[];
  status: "available" | "occupied" | "maintenance";
  images?: string[];
  description?: string;
  currentPrice?: number;
}

export interface RoomSearchParams {
  checkInDate: string;
  checkOutDate: string;
  minPrice?: number;
  maxPrice?: number;
  roomTypeId?: string;
  tags?: string[];
  sortBy?: string;
  limit?: number;
  page?: number;
}

// src/types/booking.types.ts
export interface Booking {
  id: string;
  room: Room;
  customer: User;
  checkInDate: string;
  checkOutDate: string;
  numberOfGuests: number;
  totalPrice: number;
  status: "pending" | "confirmed" | "checked_in" | "checked_out" | "cancelled";
  promotion?: Promotion;
  createdAt: string;
  updatedAt: string;
}

export interface CreateBookingData {
  roomId: string;
  checkInDate: string; // ISO 8601 format
  checkOutDate: string; // ISO 8601 format
  numberOfGuests: number;
  promotionId?: string;
}

// src/types/promotion.types.ts
export interface Promotion {
  id: string;
  code: string;
  description: string;
  discountType: "percentage" | "fixed";
  discountValue: number;
  startDate: string;
  endDate: string;
  isActive: boolean;
  usageLimit?: number;
  usageCount: number;
}
```

---

## UI/UX Guidelines

### Design Principles

- **Clean & Modern**: Minimalist design with focus on imagery
- **Easy Navigation**: Bottom tab navigation for main sections
- **Visual Hierarchy**: Clear CTAs, readable typography
- **Loading States**: Show spinners during API calls
- **Error Handling**: User-friendly error messages

### Color Scheme Suggestion

```typescript
// src/constants/colors.ts
export const colors = {
  primary: "#2563EB", // Blue
  secondary: "#7C3AED", // Purple
  success: "#10B981", // Green
  error: "#EF4444", // Red
  warning: "#F59E0B", // Amber
  background: "#FFFFFF",
  backgroundSecondary: "#F3F4F6",
  text: "#111827",
  textSecondary: "#6B7280",
  border: "#E5E7EB",
};
```

### Key Screens Layout

**Home Screen**

- Hero section with search bar
- Featured rooms carousel
- Quick filters (price range, capacity)
- Popular destinations

**Room List Screen**

- Grid/list view toggle
- Filter button (opens modal)
- Sort options (price, rating)
- Room cards with image, name, price, rating

**Room Detail Screen**

- Image carousel at top
- Room name and price
- Amenities icons
- Description
- Date selector
- "Book Now" button (sticky at bottom)

**Booking Screen**

- Booking summary card
- Guest details form
- Payment method selection
- Terms & conditions checkbox
- "Confirm Booking" button

---

## State Management Example

### Auth Context (Updated for Real API)

```typescript
// src/context/AuthContext.tsx
import React, { createContext, useState, useEffect } from "react";
import * as SecureStore from "expo-secure-store";
import { User, RegisterData } from "../types/auth.types";
import { authService } from "../api/services/auth.service";

interface AuthContextType {
  user: User | null;
  isLoading: boolean;
  login: (email: string, password: string) => Promise;
  logout: () => Promise;
  register: (data: RegisterData) => Promise;
}

export const AuthContext = createContext({} as AuthContextType);

export const AuthProvider: React.FC = ({ children }) => {
  const [user, setUser] = useState(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    checkAuth();
  }, []);

  const checkAuth = async () => {
    try {
      const accessToken = await SecureStore.getItemAsync("accessToken");
      const refreshToken = await SecureStore.getItemAsync("refreshToken");

      if (accessToken && refreshToken) {
        // Try to get user profile
        const userData = await profileService.getProfile();
        setUser(userData);
      }
    } catch (error) {
      // If token expired, try refresh
      try {
        const refreshToken = await SecureStore.getItemAsync("refreshToken");
        if (refreshToken) {
          const response = await authService.refreshTokens(refreshToken);
          await SecureStore.setItemAsync(
            "accessToken",
            response.tokens.access.token
          );
          await SecureStore.setItemAsync(
            "refreshToken",
            response.tokens.refresh.token
          );

          const userData = await profileService.getProfile();
          setUser(userData);
        }
      } catch (refreshError) {
        console.error("Token refresh failed:", refreshError);
        await clearAuth();
      }
    } finally {
      setIsLoading(false);
    }
  };

  const login = async (email: string, password: string) => {
    const response = await authService.login(email, password);
    await SecureStore.setItemAsync("accessToken", response.tokens.access.token);
    await SecureStore.setItemAsync(
      "refreshToken",
      response.tokens.refresh.token
    );
    setUser(response.user);
  };

  const register = async (data: RegisterData) => {
    const response = await authService.register(data);
    await SecureStore.setItemAsync("accessToken", response.tokens.access.token);
    await SecureStore.setItemAsync(
      "refreshToken",
      response.tokens.refresh.token
    );
    setUser(response.user);
  };

  const logout = async () => {
    try {
      const refreshToken = await SecureStore.getItemAsync("refreshToken");
      if (refreshToken) {
        await authService.logout(refreshToken);
      }
    } catch (error) {
      console.error("Logout error:", error);
    } finally {
      await clearAuth();
    }
  };

  const clearAuth = async () => {
    await SecureStore.deleteItemAsync("accessToken");
    await SecureStore.deleteItemAsync("refreshToken");
    setUser(null);
  };

  return { children };
};
```

---

## Navigation Structure

```typescript
// src/navigation/AppNavigator.tsx
import React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { useAuth } from '../hooks/useAuth';
import AuthNavigator from './AuthNavigator';
import MainNavigator from './MainNavigator';
import LoadingScreen from '../screens/LoadingScreen';

const AppNavigator = () => {
  const { user, isLoading } = useAuth();

  if (isLoading) {
    return ;
  }

  return (

      {user ?  : }

  );
};

export default AppNavigator;
```

---

## Error Handling

### Global Error Handler

```typescript
// src/utils/errorHandler.ts
import { Alert } from "react-native";

export const handleApiError = (error: any) => {
  let message = "An unexpected error occurred";

  if (error.response) {
    // Server responded with error
    message = error.response.data?.message || message;
  } else if (error.request) {
    // No response received
    message = "Network error. Please check your connection.";
  }

  Alert.alert("Error", message);
};
```

---

## Testing Considerations

### Important Areas to Test

- Authentication flow (login, logout, token refresh)
- Room search and filtering
- Booking creation and validation
- Date selection edge cases
- Network error handling
- Offline behavior

---

## Development Best Practices

### Code Quality

- Use TypeScript strictly (no `any` types)
- Follow React Native best practices
- Implement proper error boundaries
- Add loading states for all async operations
- Validate user input before API calls

### Performance

- Use `React.memo` for list items
- Implement FlatList for long lists (not ScrollView)
- Optimize images with appropriate sizes
- Cache API responses when appropriate
- Use pagination for room listings

### Security

- Store tokens in SecureStore only
- Validate all user input
- Use HTTPS for all API calls
- Implement proper logout (clear all data)

---

## Configuration Files

### Environment Variables

Create a `.env` file:

```
EXPO_PUBLIC_API_URL = https://room-master-dcdsfng4c7h7hwbg.eastasia-01.azurewebsites.net/v1
```

### app.json Configuration

```json
{
  "expo": {
    "name": "Room Master",
    "slug": "room-master",
    "version": "1.0.0",
    "orientation": "portrait",
    "icon": "./assets/icon.png",
    "splash": {
      "image": "./assets/splash.png",
      "resizeMode": "contain",
      "backgroundColor": "#2563EB"
    },
    "ios": {
      "bundleIdentifier": "com.roommaster.app",
      "supportsTablet": true
    },
    "android": {
      "package": "com.roommaster.app",
      "adaptiveIcon": {
        "foregroundImage": "./assets/adaptive-icon.png",
        "backgroundColor": "#2563EB"
      }
    }
  }
}
```

---

## Getting Started Commands

```bash
# Initialize Expo project
npx create-expo-app room-master-app --template blank-typescript

# Install dependencies
npm install @react-navigation/native @react-navigation/stack @react-navigation/bottom-tabs
npm install axios react-hook-form date-fns
npm install expo-secure-store react-native-calendars

# Run on iOS
npm run ios

# Run on Android
npm run android

# Run on web
npm run web
```

---

## Additional Notes for AI Agent

- The backend API is already deployed at: `https://room-master-dcdsfng4c7h7hwbg.eastasia-01.azurewebsites.net/v1`
- All customer endpoints are prefixed with `/customer`
- Authentication uses JWT tokens with separate access and refresh tokens
- Access tokens expire and must be refreshed using the refresh token
- Store both `accessToken` and `refreshToken` in SecureStore
- The API returns structured responses - check the actual response format from the API
- Room search supports multiple query parameters for filtering
- Booking status follows this lifecycle: `pending` → `confirmed` → `checked_in` → `checked_out` (or `cancelled`)
- Promotions can be applied during booking creation by passing `promotionId`
- Date formats should be ISO 8601 (e.g., "2024-01-15T00:00:00.000Z")
- Handle API errors gracefully and show user-friendly messages
- Implement loading states for all async operations
- Add proper TypeScript types based on actual API responses
- Test all endpoints with the real backend before finalizing
- Implement token refresh logic to handle expired access tokens automatically
- The backend supports pagination for bookings (use `limit` and `page` query params)

---

## Success Criteria

The app should:
✅ Allow users to browse available rooms
✅ Support search and filtering functionality
✅ Enable complete booking flow from selection to confirmation
✅ Maintain user authentication across app restarts
✅ Display booking history and allow cancellations
✅ Handle network errors gracefully
✅ Provide smooth navigation and good UX
✅ Work on both iOS and Android platforms

---

**Last Updated**: January 2026
**Target Platform**: iOS 14+, Android 11+
**Expo SDK**: 51.x
